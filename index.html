<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Abyss Alchemy - Water Sort Rogue</title>
    <link rel="icon" href="./icons/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div id="help-overlay"></div>
    <div>
        <div id="toast-container"
            class="fixed top-20 left-1/2 -translate-x-1/2 z-[200] flex flex-col gap-2 w-full max-w-sm px-4"></div>
        <div id="global-tooltip"></div>
        <div id="game-container"
            class="flex flex-col items-center justify-between h-screen w-screen p-2 md:p-4 overflow-hidden relative">
            <div id="alert-banner">NO MOVES LEFT</div>
            <div id="top-hud" class="w-full max-w-5xl glass-panel p-3 md:p-4 flex items-center justify-between z-[150] shrink-0 mb-2">
                <div class="flex items-center gap-4">
                    <div>
                        <div class="text-[10px] text-slate-400 uppercase tracking-[0.35em]" id="ui-subtitle">Èå¨ÈáëË°ì„ÅÆÊ∑±Ê∑µ
                        </div>
                        <div class="text-xl md:text-2xl font-black tracking-tight leading-none bg-gradient-to-br from-white to-slate-400 bg-clip-text text-transparent"
                            id="ui-title">Abyss Alchemy</div>
                    </div>
                    <div class="hidden md:flex items-center gap-3 ml-4">
                        <span class="px-4 py-2 rounded-xl glass-panel text-xl font-bold border border-white/5"
                            id="ui-floor">FLOOR 1</span>
                        <span
                            class="px-4 py-2 rounded-xl glass-panel text-xl font-bold text-sky-300 border border-white/5"
                            id="ui-essence">‚ú® 0</span>
                        <div
                            class="relative w-32 h-10 rounded-xl border-2 border-rose-500 bg-slate-900/80 overflow-hidden shadow-[0_0_15px_rgba(244,63,94,0.5)] shrink-0">
                            <div id="ui-hp-bar"
                                class="absolute top-0 left-0 h-full bg-rose-600 transition-all duration-300"
                                style="width: 100%;"></div>
                            <div class="absolute inset-0 flex items-center justify-center z-10">
                                <span id="ui-hp-text" class="text-lg font-black text-white drop-shadow-md">HP 3</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="btn-mutations"
                        class="w-10 h-10 md:w-auto md:h-auto md:px-4 md:py-2 flex items-center justify-center glass-panel font-bold text-xs uppercase tracking-widest hover:bg-white/5 active:scale-95 transition-all text-sky-300 border-sky-500/30">
                        <span class="md:hidden">üß¨</span><span class="hidden md:inline"
                            id="btn-mutations-text">Status</span>
                    </button>
                    <button id="btn-retire"
                        class="w-10 h-10 md:w-auto md:h-auto md:px-4 md:py-2 flex items-center justify-center glass-panel font-bold text-xs uppercase tracking-widest hover:bg-white/5 active:scale-95 transition-all text-rose-300 border-rose-500/30">
                        <span class="md:hidden">üè≥Ô∏è</span><span class="hidden md:inline"
                            id="btn-retire-text">Retire</span>
                    </button>
                    <button id="btn-palette"
                        class="w-10 h-10 md:w-auto md:h-auto md:px-4 md:py-2 flex items-center justify-center glass-panel font-bold text-xs uppercase tracking-widest hover:bg-white/5 active:scale-95 transition-all text-yellow-300 border-yellow-500/30">
                        <span class="md:hidden">üé®</span><span class="hidden md:inline"
                            id="btn-palette-text">Pallet</span>
                    </button>
                    <button id="btn-help"
                        class="w-10 h-10 md:w-auto md:h-auto md:px-4 md:py-2 flex items-center justify-center glass-panel font-bold text-xs uppercase tracking-widest hover:bg-white/5 active:scale-95 transition-all">
                        <span class="md:hidden">?</span><span class="hidden md:inline" id="btn-help-text">Help</span>
                    </button>
                </div>
            </div>
            <div id="status-bar" class="w-full max-w-5xl flex gap-2 shrink-0 z-[150] mb-2">
                <div
                    class="flex-1 glass-panel px-4 py-2 border-l-4 border-l-sky-500/50 flex flex-col justify-center gap-1">
                    <div class="text-base font-black tracking-tight text-white" id="ui-goal">‚Äî</div>
                    <div class="text-base font-bold" id="ui-goal-sub">‚Äî</div>
                </div>
                <div class="w-[180px] md:w-[220px] glass-panel px-4 py-2 border-l-4 border-l-rose-500/50">
                    <div class="text-[10px] text-slate-400 uppercase tracking-[0.35em]" id="ui-pressure-label">PRESSURE</div>
                    <div class="flex items-center gap-2 mt-1">
                        <div class="flex-1 h-6 rounded-full bg-slate-800/80 overflow-hidden relative border border-white/5">
                            <div id="ui-pressure-bar"
                                class="h-full rounded-full bg-gradient-to-r from-sky-400 via-purple-400 to-rose-500 transition-all duration-300"
                                style="width:0%"></div>
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <span id="ui-pressure-sub" class="text-[11px] font-black text-white drop-shadow-md">0 / 20</span>
                            </div>
                        </div>
                        </div>
                </div>
            </div>
            <div id="board-area" class="flex-1 w-full relative z-10 overflow-hidden my-2">
                <div id="board-scroll-area">
                    <div id="tubes-container"></div>
                </div>
            </div>
            <div id="skills-container" class="w-full max-w-4xl mb-2 min-h-[70px] shrink-0">
            </div>
            <div id="bottom-hud" class="w-full max-w-5xl glass-panel p-3 md:p-4 shrink-0 z-20 mb-safe">
                <div class="md:hidden flex items-center justify-between mb-3 px-1 gap-2 text-sm font-bold">
                    <span class="text-slate-300 bg-white/5 px-2 py-1 rounded border border-white/10"
                        id="ui-floor-mobile">1F</span>
                    <div class="flex gap-3">
                        <span class="text-sky-300" id="ui-essence-mobile">‚ú® 0</span>
                    </div>
                    <div
                        class="relative w-20 h-6 rounded-lg border border-rose-500 bg-slate-900/80 overflow-hidden shadow-[0_0_10px_rgba(244,63,94,0.4)] shrink-0">
                        <div id="ui-hp-mobile-bar"
                            class="absolute top-0 left-0 h-full bg-rose-600 transition-all duration-300"
                            style="width: 100%;"></div>
                        <div class="absolute inset-0 flex items-center justify-center z-10">
                            <span id="ui-hp-mobile-text"
                                class="text-sm font-black text-white drop-shadow-md leading-none pt-0.5">HP 3</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between gap-3 relative">
                    <div class="flex items-center gap-2 md:gap-3 flex-wrap">
                        <span
                            class="px-4 py-2 rounded-xl glass-panel text-sm font-black tracking-tight text-white border border-white/5"
                            id="ui-turn">TURN 0</span>
                    </div>
                    <button id="btn-undo"
                        class="px-4 py-2 rounded-xl font-bold text-xs uppercase tracking-widest text-slate-300 flex items-center gap-2">
                        <span>‚Ü∫</span> UNDO (‚ú®5)
                    </button>
                </div>
            </div>
        </div>
        <div id="event-screen"
            class="fixed inset-0 z-[220] bg-slate-950/50 hidden items-center justify-center p-6 transition-opacity">
            <div class="glass-panel w-full max-w-2xl p-6 border border-sky-500/20 shadow-2xl shadow-sky-900/20">
                <div class="flex items-end justify-between gap-4">
                    <div>
                        <div class="text-[16px] text-sky-400 uppercase tracking-[0.35em] font-bold" id="event-kicker">
                            EVENT</div>
                        <div class="text-3xl font-black tracking-tight text-white mt-1" id="event-title">‚Äî</div>
                        <div class="text-slate-300 text-sm mt-3 whitespace-pre-line leading-relaxed" id="event-desc">‚Äî
                        </div>
                    </div>
                    <div class="text-right shrink-0">
                        <div
                            class="px-3 py-1 bg-rose-500/10 border border-rose-500/30 rounded text-[10px] text-rose-300 uppercase tracking-[0.2em]">
                            Unavoidable</div>
                    </div>
                </div>
                <div class="grid md:grid-cols-2 gap-4 mt-8" id="event-choices"></div>
            </div>
        </div>
        <div id="start-screen" class="fixed inset-0 z-[200] flex flex-col items-center justify-center bg-slate-950 p-8">
            <div class="absolute top-8 right-8 z-50 flex items-start gap-2">
                <div class="glass-panel p-1 flex items-center gap-1 shrink-0">
                    <button onclick="setLang('en')" id="lang-en" class="lang-btn">EN</button>
                    <button onclick="setLang('ja')" id="lang-ja" class="lang-btn active">JP</button>
                </div>
                <div class="flex flex-col gap-1 shrink-0 w-[130px]">
                    <div class="glass-panel p-1 flex items-center gap-1 justify-between">
                        <button onclick="setPalette('default')" id="pal-default"
                            class="lang-btn active flex-1 text-center px-0" title="Standard">STD</button>
                        <button onclick="setPalette('vivid')" id="pal-vivid" class="lang-btn flex-1 text-center px-0"
                            title="Vivid / Contrast">VIV</button>
                        <button onclick="setPalette('universal')" id="pal-universal"
                            class="lang-btn flex-1 text-center px-0" title="Universal / Distinct">UNI</button>
                    </div>
                    <div id="palette-preview"
                        class="glass-panel p-[3px] flex gap-[1px] pointer-events-none h-6 w-full overflow-hidden"></div>
                </div>
            </div>
            <div class="text-center mb-16 floating relative">
                <div class="absolute inset-0 bg-sky-500/20 blur-[100px] rounded-full"></div>
                <h1
                    class="relative text-5xl md:text-7xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-b from-sky-300 via-sky-500 to-indigo-600 drop-shadow-2xl leading-tight">
                    ABYSS<br>ALCHEMY</h1>
                <p id="start-subtitle"
                    class="relative text-sky-200/60 font-medium tracking-[0.5em] uppercase text-xs mt-4">Èå¨ÈáëË°ì„ÅÆÊ∑±Ê∑µ</p>
            </div>
            <div class="flex flex-col gap-3 w-full max-w-xs">
                <button id="continue-run-btn"
                    class="hidden w-full py-4 bg-emerald-600 rounded-2xl font-black text-white uppercase tracking-widest shadow-2xl shadow-emerald-500/20 hover:bg-emerald-500 hover:shadow-emerald-500/40 hover:-translate-y-1 transition-all active:scale-95 active:translate-y-0 flex items-center justify-center gap-2">
                    <span>‚ñ∂</span> <span id="continue-btn-text">„Å§„Å•„Åç„Åã„Çâ</span>
                </button>
                <button id="start-run-btn"
                    class="w-full py-4 bg-sky-600 rounded-2xl font-black text-white uppercase tracking-widest shadow-2xl shadow-sky-500/20 hover:bg-sky-500 hover:shadow-sky-500/40 hover:-translate-y-1 transition-all active:scale-95 active:translate-y-0">
                    Êé¢Á¥¢„ÇíÈñãÂßã
                </button>
            </div>
            <p id="debug-toggle" class="text-white/60 text-[12px] mt-8 tracking-widest uppercase cursor-pointer hover:text-white transition-colors">
                Alpha Ver 0.4.05
            </p>
            <div id="debug-floor-selector" class="hidden mb-4 p-2 border border-red-500/50 bg-red-900/20 rounded-lg">
                <div class="text-[10px] text-red-400 font-bold mb-1">DEBUG: START FLOOR</div>
                <input type="number" id="debug-floor-input" value="0" min="0" max="99" 
                    class="w-full bg-black/40 border border-white/20 rounded px-2 py-1 text-white text-center font-black">
            </div>
        </div>
        <div id="perk-screen"
            class="fixed inset-0 z-[180] bg-slate-950 flex flex-col items-center justify-center p-4 md:p-8 hidden">
            <div
                class="w-full max-w-6xl h-full max-h-full flex flex-col glass-panel p-0 overflow-hidden relative border border-white/10 shadow-2xl shadow-black/80">
                <div
                    class="flex justify-between items-center p-3 md:p-6 border-b border-white/5 shrink-0 bg-slate-900/40">
                    <div>
                        <h2 id="perk-title"
                            class="text-xl md:text-3xl font-black text-white italic uppercase leading-none">„Éú„Éº„Éä„Çπ</h2>
                        <p id="perk-subtitle"
                            class="text-slate-400 text-[10px] md:text-xs mt-1 uppercase tracking-widest">
                            Âº∑Âåñ„Åæ„Åü„ÅØÁâ©Ë≥á„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                    <div class="flex items-center gap-2 md:gap-4">
                        <button id="btn-status-perk"
                            class="h-10 w-10 md:w-auto md:px-4 flex items-center justify-center gap-2 glass-panel font-bold text-base uppercase tracking-tight hover:bg-white/5 active:scale-95 transition-all text-sky-300 border-sky-500/30">
                            <span>üß¨</span><span class="hidden md:inline" id="btn-status-perk-text">STATUS</span>
                        </button>
                        <div class="text-base font-bold text-rose-400 bg-rose-900/30 px-3 py-1.5 rounded border border-rose-500/20 whitespace-nowrap flex items-center gap-1"
                            id="perk-hp">
                            <span class="text-xs">‚ù§</span> <span id="perk-hp-val">3 / 3</span>
                        </div>
                        <div class="text-base font-bold text-sky-400 bg-sky-900/30 px-3 py-1.5 rounded border border-sky-500/20 whitespace-nowrap"
                            id="perk-essence">‚ú® 0</div>
                    </div>
                </div>
                <div class="flex-1 flex flex-col md:flex-row min-h-0 overflow-hidden">
                    <div
                        class="flex-1 flex flex-col p-4 md:p-6 overflow-y-auto border-b md:border-b-0 md:border-r border-white/5 bg-slate-900/20">
                        <div
                            class="text-sm font-bold mb-3 text-sky-300 uppercase tracking-widest flex items-center gap-2">
                            <span class="text-[16px]" id="ui-mutations-label">üß¨ „Çπ„Ç≠„É´</span>
                            <span class="text-[10px] text-slate-500 font-normal normal-case">Pick One (Updates every
                                level)</span>
                        </div>
                        <div class="grid gap-3" id="perk-cards">
                        </div>
                    </div>
                    <div class="flex-1 flex flex-col p-4 md:p-6 overflow-y-auto">
                        <div class="flex justify-between items-center mb-3">
                            <div
                                class="text-sm font-bold text-yellow-500 uppercase tracking-widest flex items-center gap-2">
                                <span class="text-[16px]">‚óà Shop</span>
                                <span class="text-[10px] text-slate-500 font-normal normal-case">4 Random Items</span>
                            </div>
                            <button id="reroll-btn"
                                class="px-3 py-1 glass-panel border border-white/10 text-[10px] font-black uppercase tracking-widest hover:bg-white/5 active:scale-95 transition-all hidden"></button>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-2 gap-3" id="shop-cards">
                        </div>
                    </div>
                </div>
                <div class="p-4 border-t border-white/5 bg-slate-900/40 shrink-0 flex justify-center z-10">
                    <button id="continue-btn"
                        class="w-full max-w-md py-3 bg-indigo-600 rounded-xl font-black text-white text-sm uppercase tracking-widest shadow-lg shadow-indigo-900/40 hover:bg-indigo-500 transition-all active:scale-95">Next
                        Floor</button>
                </div>
            </div>
        </div>
        <div id="help-screen"
            class="fixed inset-0 z-[210] bg-slate-950/90 backdrop-blur hidden items-center justify-center p-6">
            <div class="glass-panel w-full max-w-2xl p-8 border border-white/10">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <div class="text-[10px] text-slate-400 uppercase tracking-[0.35em]">HELP</div>
                        <div class="text-3xl font-black tracking-tight">Guide</div>
                    </div>
                    <button id="help-close"
                        class="px-4 py-2 glass-panel font-black text-xs uppercase tracking-widest hover:bg-white/10 active:scale-95 transition-colors">Close</button>
                </div>
                <div class="text-slate-300 text-sm leading-loose whitespace-pre-line font-medium" id="help-text"></div>
            </div>
        </div>
        <div id="mutations-screen"
            class="fixed inset-0 z-[210] bg-slate-950/90 backdrop-blur hidden items-center justify-center p-6">
            <div class="glass-panel w-full max-w-3xl p-8 border border-white/10 flex flex-col h-[85vh]">
                <div class="flex justify-between items-center mb-6 shrink-0">
                    <div>
                        <div class="text-[10px] text-sky-400 uppercase tracking-[0.35em]" id="mutations-modal-subtitle">
                            STATUS</div>
                        <div class="text-3xl font-black tracking-tight text-white" id="mutations-modal-title">Bonus &
                            Stats</div>
                    </div>
                    <button id="mutations-close"
                        class="px-4 py-2 glass-panel font-black text-xs uppercase tracking-widest hover:bg-white/10 active:scale-95 transition-colors">Close</button>
                </div>
                <div class="flex-1 overflow-y-auto space-y-8 pr-2">
                    <div>
                        <div class="text-slate-500 text-xs italic py-3">Total Parameters</div>
                        <div id="mutations-stats-summary" class="stat-grid">
                        </div>
                    </div>
                    <div>
                        <div class="text-slate-500 text-xs italic py-3">Active Bonuses</div>
                        <div id="mutations-list-container" class="grid gap-2">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="palette-screen"
            class="fixed inset-0 z-[210] bg-slate-950/90 backdrop-blur hidden items-center justify-center p-6">
            <div class="glass-panel w-full max-w-md p-8 border border-white/10 flex flex-col gap-6">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-[10px] text-yellow-400 uppercase tracking-[0.35em]">COLOR</div>
                        <div class="text-3xl font-black tracking-tight text-white" id="palette-modal-title">Color Pallet
                        </div>
                    </div>
                    <button id="palette-close"
                        class="px-4 py-2 glass-panel font-black text-xs uppercase tracking-widest hover:bg-white/10 active:scale-95 transition-colors">Close</button>
                </div>
                <div class="flex flex-col gap-3">
                    <button onclick="setPalette('default'); closeModal('palette-screen');" id="modal-pal-default"
                        class="w-full py-4 glass-panel border border-white/10 hover:bg-white/5 active:scale-95 transition-all flex items-center justify-between px-6 group">
                        <div class="flex flex-col items-start">
                            <span
                                class="text-lg font-black text-white group-hover:text-sky-300 transition-colors">STANDARD</span>
                            <span class="text-[10px] text-slate-400">Basic / Âü∫Êú¨</span>
                        </div>
                        <div class="flex gap-1">
                            <div class="w-3 h-3 rounded-full bg-[#dc2626]"></div>
                            <div class="w-3 h-3 rounded-full bg-[#3b82f6]"></div>
                            <div class="w-3 h-3 rounded-full bg-[#fbbf24]"></div>
                        </div>
                    </button>
                    <button onclick="setPalette('vivid'); closeModal('palette-screen');" id="modal-pal-vivid"
                        class="w-full py-4 glass-panel border border-white/10 hover:bg-white/5 active:scale-95 transition-all flex items-center justify-between px-6 group">
                        <div class="flex flex-col items-start">
                            <span
                                class="text-lg font-black text-white group-hover:text-sky-300 transition-colors">VIVID</span>
                            <span class="text-[10px] text-slate-400">Contrast / „Ç≥„É≥„Éà„É©„Çπ„Éà</span>
                        </div>
                        <div class="flex gap-1">
                            <div class="w-3 h-3 rounded-full bg-[#ff0000]"></div>
                            <div class="w-3 h-3 rounded-full bg-[#0044ff]"></div>
                            <div class="w-3 h-3 rounded-full bg-[#ffcc00]"></div>
                        </div>
                    </button>
                    <button onclick="setPalette('universal'); closeModal('palette-screen');" id="modal-pal-universal"
                        class="w-full py-4 glass-panel border border-white/10 hover:bg-white/5 active:scale-95 transition-all flex items-center justify-between px-6 group">
                        <div class="flex flex-col items-start">
                            <span
                                class="text-lg font-black text-white group-hover:text-sky-300 transition-colors">UNIVERSAL</span>
                            <span class="text-[10px] text-slate-400">Distinct / „É¶„Éã„Éê„Éº„Çµ„É´</span>
                        </div>
                        <div class="flex gap-1">
                            <div class="w-3 h-3 rounded-full bg-[#ff4b00]"></div>
                            <div class="w-3 h-3 rounded-full bg-[#005aff]"></div>
                            <div class="w-3 h-3 rounded-full bg-[#f6aa00]"></div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
        <div id="dev-tests"></div>
    </div>
    <script src="./script/script.js"></script>
</body>
</html>